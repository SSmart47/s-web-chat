const firebaseConfig={apiKey:"AIzaSyCgaZiQPZPEsbFF75Hues-jHAgTnTuEg44",authDomain:"swebchat-57d61.firebaseapp.com",databaseURL:"https://swebchat-57d61-default-rtdb.firebaseio.com",projectId:"swebchat-57d61",storageBucket:"swebchat-57d61.appspot.com",messagingSenderId:"1022482092623",appId:"1:1022482092623:web:cd0a82665533392662503a"};firebase.initializeApp(firebaseConfig);var username=localStorage.getItem("ss47_s_web_chat_user_i"),_u_n_=localStorage.getItem("ss47_s_web_chat_user_n"),ouser=localStorage.getItem("ss47_s_web_chat_user_o"),chat_id=localStorage.getItem("ss47_s_web_chat_user_ci");function JsonToList(e){var t,a=e,n=[];for(t in a)n.push([t,a[t]]);return n}function RefrechChat(){firebase.database().ref().get().then(e=>{e.exists()?(e=JsonToList(e.val()),document.getElementById("id_usero_name").innerHTML=e[1][1][ouser].nick):console.log("Server Error!")}).catch(e=>{alert("No Connection!"),console.error(e)})}function Part(e,t){for(var a="",n="",r=0,o=0;o<e.length;o++)"a"==e[o]?r++:0==r?a+=e[o]:n+=e[o];return 1==t?a:n}function ToInteger(e){return e.charCodeAt(0)}function ToChar(e){return String.fromCharCode(parseInt(e))}function Encrypt(e){for(var t="",a=0;a<e.length;a++)t+="%"+ToInteger(e[a]);return t}function Decode(e){var t="",a="";e+="%";for(var n=1;n<e.length;n++)"%"==e[n]?(t+=ToChar(a),a=""):a+=e[n];return t}function Fixed(e){for(var t="",a=0;a<e.length;a++)" "==e[a]?t+="&nbsp;":t+=e[a];return t}function UpdateChat(){firebase.database().ref().get().then(e=>{if(e.exists()){var t=JsonToList(e.val().chats[chat_id]),a=document.getElementById("id_my_1"),n=a.innerHTML="";n+=username;for(var r=0;r<t.length;r++){for(var o=t[r][1].description,s="",c=0;c<o.length;c++){if("%"==o[c]){for(var i="",d=c;d<o.length;d++)i+=o[d];o="",o+=i;break}s+=o[c]}o=Decode(o);var l="css-text-";l+=s==n?"right":"left",a.innerHTML+='<div class="'+l+'" id="id_div_'+r+'"></div>';for(var _=document.getElementById("id_div_"+r),h=0;h<o.length;h++)" "==o[h]?_.innerHTML+="&nbsp;":_.innerText+=o[h]}}else console.log("Server Error!")}).catch(e=>{alert("No Connection!"),console.error(e)})}RefrechChat(),document.getElementById("id_btn_back").onclick=function(){localStorage.setItem("ss47_s_web_chat_user_i",username),localStorage.setItem("ss47_s_web_chat_user_n",_u_n_),localStorage.setItem("ss47_s_web_chat_user_o",""),window.location="../../main.html"},document.getElementById("id_btn_send_message").onclick=function(){var t=document.getElementById("id_text").value;""!=t?(t=username+Encrypt(t),firebase.database().ref().get().then(e=>{e.exists()?(e=e.val(),cln=0,null==e.chats[chat_id]||(e=JsonToList(e.chats[chat_id]),cln=e.length),firebase.database().ref("chats/"+chat_id+"/"+cln).set({description:t})):console.log("Server Error!")}).catch(e=>{alert("No Connection!"),console.error(e)})):alert("EMPTY MESSAGE!")},firebase.database().ref("chats").child(chat_id).on("child_changed",function(e){console.log("~changed"),UpdateChat()}),firebase.database().ref("chats").child(chat_id).on("child_added",function(e){console.log("~added"),UpdateChat()});
